<html>
<head>
<script type="text/javascript" src="headtrackr.js"></script>
</head>
<body>
<canvas id="inputCanvas" width="320" height="240" style="display:none"></canvas>
<video id="inputVideo" autoplay loop></video>

<div id="values">Values: </div>

<script type="text/javascript">


average = function(a) {
  var r = {mean: 0, variance: 0, deviation: 0}, t = a.length;
  for(var m, s = 0, l = t; l--; s += a[l]);
  for(m = r.mean = s / t, l = t, s = 0; l--; s += Math.pow(a[l] - m, 2));
  return r.deviation = Math.sqrt(r.variance = s / t), r;
}

var x;

  var videoInput = document.getElementById('inputVideo');
  var canvasInput = document.getElementById('inputCanvas');

  var htracker = new headtrackr.Tracker({calcAngles : true});
  htracker.init(videoInput, canvasInput);
  htracker.start();

  var div = document.getElementById('values');
  var last1000 = [];

  document.addEventListener('facetrackingEvent', function (event) {
    if (event.detection == "CS") {

      div.innerHTML = last1000.length + "<br>";

      if(last1000.length < 100){
  		last1000.push(event.angle);
      }

      if(last1000.length >= 100){
      	x = average(last1000);
      	div.innerHTML = event.angle + " " + x.deviation + "<br>";
      	last1000.shift();
      	last1000.push(event.angle);

      }
    }
  }
);


</script>
</body>
</html>